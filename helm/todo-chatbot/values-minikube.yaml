# [Task]: T107
# [Spec]: F-009 (US11)
# [Description]: Minikube-specific values with NodePort configuration

# Global settings for Minikube
global:
  imageRegistry: ""
  imagePullSecrets: []
  namespace: todo-app

# Backend service - expose via NodePort for Minikube access
backend:
  enabled: true
  replicaCount: 1
  image:
    repository: taskai/backend
    pullPolicy: Never  # Use local images in Minikube
    tag: "latest"
  service:
    type: NodePort
    port: 8000
    nodePort: 30080  # Access at minikube-ip:30080
  dapr:
    enabled: true
    appId: taskai-backend
    appPort: 8000
    logLevel: debug
  config:
    databaseUrl: "postgresql://taskai:taskai_secret@taskai-postgres:5432/taskai"
    secretKey: "dev-secret-key-change-in-production-32chars"
    jwtSecret: "dev-jwt-secret-key-minimum-32-characters-long"
    openaiApiKey: "sk-placeholder-for-development"
    daprEnabled: "true"
    daprHttpPort: "3500"
    pubsubName: "kafka-pubsub"
    logLevel: "DEBUG"
  resources:
    limits:
      cpu: 500m
      memory: 512Mi
    requests:
      cpu: 100m
      memory: 256Mi
  health:
    livenessPath: /health
    readinessPath: /ready
    startupPath: /startup
    initialDelaySeconds: 60
    periodSeconds: 15
    timeoutSeconds: 10
    failureThreshold: 5
    startupFailureThreshold: 30

# Frontend service - expose via NodePort for Minikube access
frontend:
  enabled: true
  replicaCount: 1
  image:
    repository: taskai/frontend
    pullPolicy: Never  # Use local images in Minikube
    tag: "latest"
  service:
    type: NodePort
    port: 3000
    nodePort: 30000  # Access at minikube-ip:30000
  config:
    backendUrl: "http://taskai-backend:8000"
    nodeEnv: "development"
  resources:
    limits:
      cpu: 500m
      memory: 512Mi
    requests:
      cpu: 100m
      memory: 256Mi
  health:
    livenessPath: /api/health
    readinessPath: /api/health
    initialDelaySeconds: 30
    periodSeconds: 15
    timeoutSeconds: 10
    failureThreshold: 5

# Notification service - internal only
notification-service:
  enabled: true
  replicaCount: 1
  image:
    repository: taskai/notification-service
    pullPolicy: Never  # Use local images in Minikube
    tag: "latest"
  service:
    type: ClusterIP
    port: 8001
  dapr:
    enabled: true
    appId: taskai-notification-service
    appPort: 8001
    logLevel: debug
  config:
    pubsubName: "kafka-pubsub"
    logLevel: "DEBUG"
    logFormat: "json"
  resources:
    limits:
      cpu: 250m
      memory: 256Mi
    requests:
      cpu: 50m
      memory: 128Mi
  health:
    livenessPath: /health
    readinessPath: /health
    initialDelaySeconds: 30
    periodSeconds: 15
    timeoutSeconds: 10
    failureThreshold: 5

# Recurring service - internal only
recurring-service:
  enabled: true
  replicaCount: 1
  image:
    repository: taskai/recurring-service
    pullPolicy: Never  # Use local images in Minikube
    tag: "latest"
  service:
    type: ClusterIP
    port: 8002
  dapr:
    enabled: true
    appId: taskai-recurring-service
    appPort: 8002
    logLevel: debug
  config:
    backendUrl: "http://taskai-backend:8000"
    pubsubName: "kafka-pubsub"
    logLevel: "DEBUG"
    logFormat: "json"
  resources:
    limits:
      cpu: 250m
      memory: 256Mi
    requests:
      cpu: 50m
      memory: 128Mi
  health:
    livenessPath: /health
    readinessPath: /health
    initialDelaySeconds: 30
    periodSeconds: 15
    timeoutSeconds: 10
    failureThreshold: 5

# Enable in-cluster PostgreSQL for Minikube
postgresql:
  enabled: true
  auth:
    postgresPassword: "postgres"
    database: taskai
  primary:
    persistence:
      enabled: true
      size: 1Gi
    resources:
      limits:
        cpu: 500m
        memory: 512Mi
      requests:
        cpu: 100m
        memory: 256Mi

# Dapr configuration for Minikube
dapr:
  enabled: true
  components:
    pubsub:
      name: kafka-pubsub
      type: pubsub.kafka
      metadata:
        brokers: "kafka-cluster-kafka-bootstrap.kafka:9092"
    statestore:
      name: statestore
      type: state.postgresql
      metadata:
        connectionString: "host=postgres user=postgres password=postgres port=5432 dbname=taskai sslmode=disable"
