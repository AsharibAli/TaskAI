{{- /*
# [Task]: Cloud-Native Implementation
# [Description]: Secret templates for DOCR, database, and Kafka credentials
# NOTE: These are template secrets. In production, use External Secrets Operator
# or create secrets manually via kubectl before deployment.
*/ -}}

{{- if .Values.secrets }}
{{- if .Values.secrets.docr }}
---
# DigitalOcean Container Registry (DOCR) credentials
# Create this secret before deployment using:
# kubectl create secret docker-registry docr-credentials \
#   --docker-server=registry.digitalocean.com \
#   --docker-username=<your-docr-token> \
#   --docker-password=<your-docr-token> \
#   --docker-email=<your-email> \
#   -n {{ include "todo-chatbot.namespace" . }}
apiVersion: v1
kind: Secret
metadata:
  name: docr-credentials
  namespace: {{ include "todo-chatbot.namespace" . }}
  labels:
    {{- include "todo-chatbot.labels" . | nindent 4 }}
  annotations:
    "helm.sh/resource-policy": keep
type: kubernetes.io/dockerconfigjson
data:
  # Base64 encoded Docker config JSON
  # Generate with: echo -n '{"auths":{"registry.digitalocean.com":{"auth":"<base64-token>"}}}' | base64
  .dockerconfigjson: {{ .Values.secrets.docr.dockerConfigJson | default "" | b64enc | quote }}
{{- end }}

{{- if .Values.secrets.database }}
---
# Database credentials for DigitalOcean Managed PostgreSQL
# Create this secret before deployment using:
# kubectl create secret generic database-credentials \
#   --from-literal=username=<db-username> \
#   --from-literal=password=<db-password> \
#   --from-literal=host=<db-host> \
#   --from-literal=connection-string="postgresql://<username>:<password>@<host>:<port>/<database>?sslmode=require" \
#   -n {{ include "todo-chatbot.namespace" . }}
apiVersion: v1
kind: Secret
metadata:
  name: database-credentials
  namespace: {{ include "todo-chatbot.namespace" . }}
  labels:
    {{- include "todo-chatbot.labels" . | nindent 4 }}
  annotations:
    "helm.sh/resource-policy": keep
type: Opaque
data:
  username: {{ .Values.secrets.database.username | default "" | b64enc | quote }}
  password: {{ .Values.secrets.database.password | default "" | b64enc | quote }}
  host: {{ .Values.secrets.database.host | default "" | b64enc | quote }}
  connection-string: {{ .Values.secrets.database.connectionString | default "" | b64enc | quote }}
{{- end }}

{{- if .Values.secrets.kafka }}
---
# Kafka credentials for DigitalOcean Managed Kafka
# Create this secret before deployment using:
# kubectl create secret generic kafka-credentials \
#   --from-literal=brokers=<kafka-broker-url> \
#   --from-literal=username=<kafka-username> \
#   --from-literal=password=<kafka-password> \
#   -n {{ include "todo-chatbot.namespace" . }}
apiVersion: v1
kind: Secret
metadata:
  name: kafka-credentials
  namespace: {{ include "todo-chatbot.namespace" . }}
  labels:
    {{- include "todo-chatbot.labels" . | nindent 4 }}
  annotations:
    "helm.sh/resource-policy": keep
type: Opaque
data:
  brokers: {{ .Values.secrets.kafka.brokers | default "" | b64enc | quote }}
  username: {{ .Values.secrets.kafka.username | default "" | b64enc | quote }}
  password: {{ .Values.secrets.kafka.password | default "" | b64enc | quote }}
{{- end }}

{{- if .Values.secrets.backend }}
---
# Backend application secrets
# Create this secret before deployment using:
# kubectl create secret generic backend-secrets \
#   --from-literal=SECRET_KEY=<your-secret-key> \
#   --from-literal=OPENAI_API_KEY=<your-openai-key> \
#   --from-literal=RESEND_API_KEY=<your-resend-key> \
#   -n {{ include "todo-chatbot.namespace" . }}
apiVersion: v1
kind: Secret
metadata:
  name: backend-secrets
  namespace: {{ include "todo-chatbot.namespace" . }}
  labels:
    {{- include "todo-chatbot.labels" . | nindent 4 }}
  annotations:
    "helm.sh/resource-policy": keep
type: Opaque
data:
  SECRET_KEY: {{ .Values.secrets.backend.secretKey | default "" | b64enc | quote }}
  OPENAI_API_KEY: {{ .Values.secrets.backend.openaiApiKey | default "" | b64enc | quote }}
  RESEND_API_KEY: {{ .Values.secrets.backend.resendApiKey | default "" | b64enc | quote }}
{{- end }}
{{- end }}
